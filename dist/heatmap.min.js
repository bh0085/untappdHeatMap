"use strict";function Controller(){var a=function(){if(app.view.mainUIView.showLocationLoader(),app.view.googleMapsView.init(),navigator.geolocation)navigator.geolocation.getCurrentPosition(function(a){console.log(a.coords),app.model.user.location.lat=a.coords.latitude,app.model.user.location.lng=a.coords.longitude,app.view.googleMapsView.map.setCenter({lat:app.model.user.location.lat,lng:app.model.user.location.lng}),app.model.geoSuccess=!0,app.view.mainUIView.removeLocationLoader(),b(),c()},function(a){console.log(a),app.view.mainUIView.removeLocationLoader();var b=dataParse.createGeoLocFailMessage(a);return app.view.mainUIView.fadeInModal(b),app.model.geoSuccess=!1,a},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});else{console.log("No browser support for geolocation."),app.view.mainUIView.removeLocationLoader();var a=dataParse.createGeoLocDeniedMessage();app.view.mainUIView.fadeInModal(a),app.model.geoSuccess=!1}},b=function(){app.view.googleMapsView.markUserLocation(app.model.user.getGoogleLatLng(),"I am here.")},c=function(){app.view.googleMapsView.resetMapCenter()},d=function(a){var b;app.model.user.location.lat&&app.model.user.location.lng?(console.debug("getLocalPubData > using Google generated lat/lng"),b=app.model.untappdApi.getPubsUri(app.model.user.location.lat,app.model.user.location.lng)):(console.warn("getLocalPubData > using Chicago Loop default location"),b="https://api.untappd.com/v4/thepub/local?access_token=A3DF816D42AA28B509413D4903139E8650A2B5C4&lat=41.8854785&lng=-87.6402523"),app.view.mainUIView.toggleCheckinsLoadIcon(),$.ajax({url:b}).done(function(b){app.model.pubsResponse=b,console.log("ajax successful"),app.model.heatMapData=dataParse.getLatLngArray(b),app.model.googleMVCArray=new google.maps.MVCArray(app.model.heatMapData),app.view.mainUIView.toggleCheckinsLoadIcon(),a&&a()}).fail(function(a){console.log("ajax failed"),console.log(a),app.view.mainUIView.toggleCheckinsLoadIcon()})},e=function(){app.view.googleMapsView.displayHeatMap();var a=[];a=dataParse.groupCheckinDataByVenue(app.model.pubsResponse),app.view.googleMapsView.displayCheckinsByVenue(a)},f=function(a){var b=app.model.untappdApi.getBeerInfoUri(a);console.log(b),$.ajax({url:b}).done(function(a){console.log("beer info ajax successful");var b=dataParse.createBeerInfoDisplay(a);app.view.mainUIView.fadeInModal(b)}).fail(function(a){console.log("beer info ajax fail"),console.log(a)})};return{acquireLocation:a,displayUserMarker:b,getLocalPubData:d,displayHeatMap:e,getBeerInfo:f}}function GoogleMapsView(){console.log("GoogleMapsView");var a,b,c=[],d=[],e=function(){if(a){var b=c.shift();b.setMap(null)}else{var d={zoom:15};a=new google.maps.Map(app.model.mapCanvasElement,d),console.log("GoogleMapsView init "+a)}return a},f=function(b,d){if(!(a&&b&&d))throw new Error("Missing a parameter.");var e,f;f=new google.maps.Marker({animation:google.maps.Animation.DROP,position:b,map:a,title:d}),e=new google.maps.InfoWindow,e.setContent("Here for the beer."),e.open(a,f),c.unshift(f),g()},g=function(){a&&app.model.user.getGoogleLatLng()&&(a.setCenter(app.model.user.getGoogleLatLng()),console.log("reset center"))},h=function(){app.model.googleMVCArray&&(b=new google.maps.visualization.HeatmapLayer({data:app.model.googleMVCArray,opacity:.7,radius:40}),b.setMap(a))},i=function(){b&&b.setMap(null)},j=function(b){k(),_.each(b,function(b,e){var f,g,h=document.createElement("div");h.className="venueWindow";var i=document.createElement("h4"),j=b.length>1?" Check-ins at ":" Check-in at ";i.textContent=b.length+j+b[0].venue.venue_name,h.appendChild(i);for(var k=0;k<b.length;k++){var l=document.createElement("div");l.className="beerCheckin";var m=document.createElement("div");m.className="beerImg";var n=document.createElement("div");n.className="beerTag";var o=document.createElement("img");o.src=b[k].beer.beer_label;var p=document.createElement("h5");p.innerHTML=b[k].beer.beer_name+", "+b[k].beer.beer_abv+"% ABV<br><small>"+b[k].brewery.brewery_name+"</small>";var q=document.createElement("button");q.textContent="More info...",q.setAttribute("data-id",b[k].beer.bid),q.setAttribute("class","moreInfo btn btn-link"),$(q).click(function(){console.log(this.dataset.id),app.controller.getBeerInfo(this.dataset.id)}),l.appendChild(m),m.appendChild(o),l.appendChild(n),n.appendChild(p),n.appendChild(q),h.appendChild(l)}f=new google.maps.Marker({id:e,animation:google.maps.Animation.DROP,clickable:!0,isOpen:!1,icon:{fillColor:"#BB2B44",fillOpacity:0,strokeColor:"#f4953b",strokeOpacity:0,scale:17,path:google.maps.SymbolPath.CIRCLE},position:new google.maps.LatLng(b[0].venue.location.lat,b[0].venue.location.lng),map:a}),c.push(f),g=new google.maps.InfoWindow({id:e,clickable:!0,content:h,maxWidth:250,position:new google.maps.LatLng(b[0].venue.location.lat,b[0].venue.location.lng)}),d.push(g)}),l(c,d),m(c,d)},k=function(){_.each(c,function(a,b){b>0&&a.setMap(null)}),c=[],d=[]},l=function(a,b){_.each(b,function(b){b.addListener("closeclick",function(){var b=this,c=_.find(a,function(a){return a.id===b.id});c.isOpen=!1})})},m=function(b,c){_.each(b,function(b){b.addListener("click",function(){if(!this.isOpen){var b=this,d=_.find(c,function(a){return a.id===b.id});d&&d.open(a,this),this.isOpen=!0}})})};return{init:e,markUserLocation:f,get map(){return a},get markers(){return c},get infoWindows(){return d},resetMapCenter:g,displayHeatMap:h,removeHeatMap:i,displayCheckinsByVenue:j}}function MainUIView(a){var b,c,d,e,f,g,h,i,j,k,l,m=a;!function(){console.log("MainUIView constructor"),b=document.getElementById("titleBar"),c=document.getElementById("menu"),e=document.getElementById("menuOpenBtn"),d=document.getElementById("menuCloseBtn"),f=document.getElementById("locateMeBtn"),g=document.getElementById("showActivityBtn"),h=document.getElementById("loadIcon1"),i=document.getElementById("loadIcon2"),j=document.getElementById("infoModal"),k=document.getElementById("infoCloseBtn"),l=document.getElementById("modalContent"),$(e).click(function(){n()}),$(d).click(function(){o()}),$(f).click(function(){console.log("locate button clicked"),app.controller.acquireLocation(),o()}),$(g).click(function(){app.controller.getLocalPubData(app.controller.displayHeatMap),o()}),$(h).toggle(),$(i).toggle(),$(j).toggle(),$(k).click(function(){$(j).fadeOut()})}();var n=function(){console.log("animateMenuOn"),$(m).animate({left:"0px"},250,function(){}),$(e).fadeOut()},o=function(){$(m).animate({left:"-300px"},250,function(){}),$(e).fadeIn()},p=function(){$(h).toggle()},q=function(){$(i).toggle()},r=function(){var a=document.createElement("i");a.className="fa fa-refresh fa-spin",$(e).empty(),e.appendChild(a)},s=function(){var a=document.createElement("i");a.className="fa fa-bars",$(e).empty(),e.appendChild(a)},t=function(a){a&&($(l).empty(),l.appendChild(a),$(j).fadeIn())},u=function(){$(j).fadeOut()};return{get titleBar(){return b},toggleLocationLoadIcon:p,toggleCheckinsLoadIcon:q,showLocationLoader:r,removeLocationLoader:s,fadeInModal:t,fadeOutModal:u}}function Model(){var a,b,c,d,e,f=new User,g=!1;return{get untappdApi(){return a},set untappdApi(b){a=b},user:f,get mapCanvasElement(){return document.getElementById("map-canvas")},get mainContainerElement(){return document.getElementById("mainContainer")},get geoSuccess(){return g},set geoSuccess(a){"boolean"==typeof a&&(g=a)},get pubsResponse(){return b},set pubsResponse(a){b=a},get heatMapData(){return c},set heatMapData(a){c=a},get venueArray(){return d||(d=[]),d},get googleMVCArray(){return e},set googleMVCArray(a){e?(e.clear(),e=a):e=a}}}function UntappdApi(){var a="https://api.untappd.com/v4/",b="A3DF816D42AA28B509413D4903139E8650A2B5C4",c="thepub/local?",d="beer/info/",e=function(d,e){if(d&&e)return a+c+"access_token="+b+"&lat="+d+"&lng="+e;throw new Error("lat or lng is missing.")},f=function(c){return c?a+d+parseInt(c)+"?access_token="+b:void 0};return{getPubsUri:e,getBeerInfoUri:f}}function User(){var a={lat:null,lng:null},b=function(){return google.maps?new google.maps.LatLng(a.lat,a.lng):void 0};return{location:a,getGoogleLatLng:b}}function View(){var a=document.getElementById("mainContainer"),b=new GoogleMapsView,c=new MainUIView(a),d=function(){};return{mainUIView:c,googleMapsView:b,init:d}}var dataParse={getLatLngArray:function(a){for(var b=[],c=a.response.checkins.items,d=0;d<c.length;d++){var e=new google.maps.LatLng(c[d].venue.location.lat,c[d].venue.location.lng);b.push(e)}return b},groupCheckinDataByVenue:function(a){var b=[];return b=_.groupBy(a.response.checkins.items,function(a){return a.venue.venue_id})},truncateString:function(a,b){console.log(a);var c=a.substr(0,b-1);return c+="..."},createBeerInfoDisplay:function(a){var b=document.createElement("div"),c=document.createElement("h3"),d=document.createElement("h4"),e=document.createElement("h4"),f=document.createElement("p");b.appendChild(c),b.appendChild(d),b.appendChild(e),b.appendChild(f);var g=0===a.response.beer.beer_ibu||""===a.response.beer.beer_ibu?"<i>unknown</i>":a.response.beer.beer_ibu;return c.textContent=a.response.beer.beer_name,d.innerHTML=a.response.beer.beer_style+"<br>"+a.response.beer.beer_abv+"% ABV<br>"+g+" IBU<br>Rated: "+a.response.beer.rating_score+" / 5.0",e.innerHTML="<img style='height:40px;' src='"+a.response.beer.brewery.brewery_label+"'>&nbsp;<a href='"+a.response.beer.brewery.contact.url+"' target='blank'>"+a.response.beer.brewery.brewery_name+"</a>",f.textContent=""!==a.response.beer.beer_description?a.response.beer.beer_description:"No beer description (yet) for "+a.response.beer.beer_name+".",b},createGeoLocDeniedMessage:function(){var a=document.createElement("div"),b=document.createElement("h3"),c=document.createElement("p");return a.appendChild(b),a.appendChild(c),b.textContent="Your browser is not allowing Geolocation right now.",c.textContent="Sadness ensues...",a},createGeoLocFailMessage:function(a){var b=document.createElement("div"),c=document.createElement("h3");return b.appendChild(c),c.textContent=a.message,b}},app={controller:null,model:null,view:null,testFxn:function(){console.log("testFxn")}};window.onload=function(){Model&&View&&Controller&&(console.log("commence"),app.controller=new Controller,app.model=new Model,app.view=new View,app.model.untappdApi=new UntappdApi,app.controller.acquireLocation())};
//# sourceMappingURL=heatmap.min.js.map